# SH3: Similar nodes by count of shared edges
# movie 1 is Avatar

PREFIX dbr: <http://dbpedia.org/resource/>
PREFIX dul: <http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX dbo: <http://dbpedia.org/ontology/>
PREFIX dbp: <http://dbpedia.org/property/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?similar_node (COUNT(DISTINCT ?pair) AS ?shared_pairs) ?title {
    { SELECT DISTINCT ?p ?o ?node {
        BIND( imdb:1 AS ?node)
        ?node ?p ?o .
        FILTER(?p NOT IN ( rdf:type, owl:sameAs, imdb:color))
        FILTER EXISTS { ?different_node ?p ?o . FILTER(?node != ?different_node) }
    } LIMIT 500 }

    ?similar_node ?p ?o . FILTER(?similar_node != ?node)
    ?similar_node imdb:title ?title .
    BIND(CONCAT(STR(?p), STR(?o)) AS ?pair)  
} GROUP BY ?similar_node ?title ORDER BY DESC(?shared_pairs)